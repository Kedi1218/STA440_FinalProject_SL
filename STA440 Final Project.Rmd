---
title: "STA440 Final Project"
author: "Sophia Li"
date: "2024-12-15"
output: pdf_document
---

```{r}
# Using readr for better performance
library(readr)
suicide_data <- read_csv("SuicideChina.csv")

```
```{r}
# View first few rows
head(suicide_data)

# Check data structure
str(suicide_data)

# Summary statistics
summary(suicide_data)

```

Let's do some EDA first 


```{r}
# Frequency of 'Died'
table(suicide_data$Died)

# Frequency of 'Sex'
table(suicide_data$Sex)

# Frequency of 'Urban'
table(suicide_data$Urban)

# Frequency of 'Method'
table(suicide_data$method)

```

```{r}
# Summary of Age
summary(suicide_data$Age)

install.packages("ggplot2")
library(ggplot2)


ggplot(suicide_data, aes(x = Age)) +
  geom_histogram(binwidth = 5, fill = "blue", alpha = 0.7) +
  labs(title = "Age Distribution", x = "Age", y = "Count")
```

```{r}
ggplot(suicide_data, aes(x = Sex, fill = Died)) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Deaths by Sex", x = "Sex", y = "Proportion", fill = "Died")
```

```{r}
ggplot(suicide_data, aes(x = method, fill = Died)) +
  geom_bar(position = "fill") +
  coord_flip() +
  labs(title = "Proportion of Deaths by Method", x = "Method", y = "Proportion", fill = "Died")

```

```{r}
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  labs(title = "Age Distribution by Outcome", x = "Age", y = "Density", fill = "Died")

```

```{r}
ggplot(suicide_data, aes(x = Sex, fill = method)) +
  geom_bar(position = "fill") +
  labs(title = "Method of Suicide by Sex", x = "Sex", y = "Proportion", fill = "Method")

```

```{r}
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Urban) +
  labs(title = "Age Distribution by Outcome and Urban/Rural", x = "Age", y = "Density", fill = "Died")


```

```{r}
ggplot(suicide_data, aes(x = Education, fill = Died)) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Deaths by Education Level", x = "Education Level", y = "Proportion", fill = "Died")


```


```{r}

```

```{r}
# Interaction between Age and Gender on Death Outcome
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Sex) +
  labs(
    title = "Interaction Between Age and Gender on Death Outcome",
    x = "Age",
    y = "Density",
    fill = "Died"
  )


```
```{r}
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Year) +
  labs(
    title = "Age Distribution by Year and Death Outcome",
    x = "Age",
    y = "Density",
    fill = "Died"
  )
```
```{r}
library(ggplot2)

ggplot(suicide_data, aes(x = as.factor(Year), fill = Died)) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Deaths by Year",
    x = "Year",
    y = "Proportion",
    fill = "Died"
  )

```

```{r}
ggplot(suicide_data, aes(x = as.factor(Year), fill = Died)) +
  geom_bar() +
  labs(
    title = "Count of Deaths by Year",
    x = "Year",
    y = "Count",
    fill = "Died"
  )


```

```{r}
library(ggplot2)

ggplot(suicide_data, aes(x = as.factor(Month), fill = Died)) +
  geom_bar(position = "fill") +
  facet_wrap(~ Year) +
  labs(
    title = "Proportion of Deaths by Month Across Years",
    x = "Month",
    y = "Proportion",
    fill = "Died"
  ) +
  scale_x_discrete(labels = c("1" = "Jan", "2" = "Feb", "3" = "Mar", "4" = "Apr",
                              "5" = "May", "6" = "Jun", "7" = "Jul", "8" = "Aug",
                              "9" = "Sep", "10" = "Oct", "11" = "Nov", "12" = "Dec"))

```

```{r}
# Convert 'Died' to a factor variable
suicide_data$Died <- factor(suicide_data$Died, levels = c("no", "yes"))

# Fit logistic regression model
logistic_model <- glm(Died ~ Age + Sex + Education + Occupation + method + Urban + Year + Month, 
                      data = suicide_data, 
                      family = binomial)

# Summary of the model
summary(logistic_model)

# Odds Ratios
exp(coef(logistic_model))

```

```{r}
# Count the frequency of each occupation
occupation_counts <- table(suicide_data$Occupation)
print(occupation_counts)
```
```{r}
library(ggplot2)

# Create a stacked bar plot for Died and Hospitalised by Education
ggplot(suicide_data, aes(x = Education, fill = interaction(Died, Hospitalised))) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Death and Hospitalisation by Education Level",
    x = "Education Level",
    y = "Proportion",
    fill = "Died and Hospitalised"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Count the frequency of each occupation
educationlevels_counts <- table(suicide_data$Education)
print(educationlevels_counts)
```

```{r}
# Count the frequency of each occupation
month_counts <- table(suicide_data$Month)
print(month_counts)
```

```{r}
# Count the frequency of each occupation
age_counts <- table(suicide_data$Age)
print(age_counts)
```

```{r}
hos <- table(suicide_data$Hospitalised)
print(hos)
```

```{r}
urban <- table(suicide_data$Urban)
print(urban)
```


```{r}
library(dplyr)

# Filter dataset to include only farming and household occupations
filtered_data <- suicide_data %>%
  filter(Occupation %in% c("farming", "household"))

# Check the size of the filtered dataset
nrow(filtered_data)

# View the distribution of Died and Hospitalised in the filtered dataset
table(filtered_data$Died)
table(filtered_data$Hospitalised)

```

