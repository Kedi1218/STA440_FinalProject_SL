---
title: "STA440 Final Project"
author: "Sophia Li"
date: "2024-12-15"
output: pdf_document
---

```{r}
# Using readr for better performance
library(readr)
suicide_data <- read_csv("SuicideChina.csv")

```

```{r}
library(ggplot2)
library(dplyr)
library(pROC)
library(nnet)
library(car)
library(patchwork)
library(cowplot)
library(reshape2)
library(corrplot)
library(tidyverse)
library(knitr)
library(kableExtra)
```

```{r}

head(suicide_data)
str(suicide_data)

summary(suicide_data)

```

Let's do some EDA first

```{r}

table(suicide_data$Died)

table(suicide_data$Sex)


table(suicide_data$Urban)

table(suicide_data$method)

```

```{r}

summary(suicide_data$Age)



ggplot(suicide_data, aes(x = Age)) +
  geom_histogram(binwidth = 5, fill = "blue", alpha = 0.7) +
  labs(title = "Age Distribution", x = "Age", y = "Count")
```

```{r}
ggplot(suicide_data, aes(x = Sex, fill = Died)) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Deaths by Sex", x = "Sex", y = "Proportion", fill = "Died")
```

```{r}
ggplot(suicide_data, aes(x = method, fill = Died)) +
  geom_bar(position = "fill") +
  coord_flip() +
  labs(title = "Proportion of Deaths by Method", x = "Method", y = "Proportion", fill = "Died")

```

```{r}
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  labs(title = "Age Distribution by Outcome", x = "Age", y = "Density", fill = "Died")

```

```{r}
ggplot(suicide_data, aes(x = Sex, fill = method)) +
  geom_bar(position = "fill") +
  labs(title = "Method of Suicide by Sex", x = "Sex", y = "Proportion", fill = "Method")

```

```{r}
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Urban) +
  labs(title = "Age Distribution by Outcome and Urban/Rural", x = "Age", y = "Density", fill = "Died")


```

```{r}
ggplot(suicide_data, aes(x = Education, fill = Died)) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Deaths by Education Level", x = "Education Level", y = "Proportion", fill = "Died")


```

```{r}

```

```{r}
# Interaction between Age and Gender on Death Outcome
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Sex) +
  labs(
    title = "Interaction Between Age and Gender on Death Outcome",
    x = "Age",
    y = "Density",
    fill = "Died"
  )


```

```{r}
ggplot(suicide_data, aes(x = Age, fill = Died)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Year) +
  labs(
    title = "Age Distribution by Year and Death Outcome",
    x = "Age",
    y = "Density",
    fill = "Died"
  )
```

```{r}

ggplot(suicide_data, aes(x = as.factor(Year), fill = Died)) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Deaths by Year",
    x = "Year",
    y = "Proportion",
    fill = "Died"
  )

```

```{r}
ggplot(suicide_data, aes(x = as.factor(Year), fill = Died)) +
  geom_bar() +
  labs(
    title = "Count of Deaths by Year",
    x = "Year",
    y = "Count",
    fill = "Died"
  )


```

```{r}
ggplot(suicide_data, aes(x = as.factor(Month), fill = Died)) +
  geom_bar(position = "fill") +
  facet_wrap(~ Year) +
  labs(
    title = "Proportion of Deaths by Month Across Years",
    x = "Month",
    y = "Proportion",
    fill = "Died"
  ) +
  scale_x_discrete(labels = c("1" = "Jan", "2" = "Feb", "3" = "Mar", "4" = "Apr",
                              "5" = "May", "6" = "Jun", "7" = "Jul", "8" = "Aug",
                              "9" = "Sep", "10" = "Oct", "11" = "Nov", "12" = "Dec"))

```

```{r}
# Convert 'Died' to a factor variable
suicide_data$Died <- factor(suicide_data$Died, levels = c("no", "yes"))


logistic_model <- glm(Died ~ Age + Sex + Education + Occupation + method + Urban + Year + Month, 
                      data = suicide_data, 
                      family = binomial)

# Summary of the model
summary(logistic_model)

# Odds Ratios
exp(coef(logistic_model))

```

```{r}
# Count the frequency of each occupation
occupation_counts <- table(suicide_data$Occupation)
print(occupation_counts)
```

```{r}

# Create a stacked bar plot for Died and Hospitalised by Education
ggplot(suicide_data, aes(x = Education, fill = interaction(Died, Hospitalised))) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Death and Hospitalisation by Education Level",
    x = "Education Level",
    y = "Proportion",
    fill = "Died and Hospitalised"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Count the frequency of each occupation
educationlevels_counts <- table(suicide_data$Education)
print(educationlevels_counts)
```

```{r}
# Count the frequency of each occupation
month_counts <- table(suicide_data$Month)
print(month_counts)
```

```{r}
# Count the frequency of each occupation
age_counts <- table(suicide_data$Age)
print(age_counts)
```

```{r}
hos <- table(suicide_data$Hospitalised)
print(hos)
```

```{r}
urban <- table(suicide_data$Urban)
print(urban)
```

```{r}
# Filter dataset to include only farming and household occupations
suicide_data <- suicide_data %>%
  filter(Occupation %in% c("farming", "household"))
```

```{r}

# Filter for farming and household occupations and remove "unknown" values
cleaned_data <- suicide_data %>%
  filter(Occupation %in% c("farming", "household")) %>%   # Keep only farming and household
  filter(!Education %in% c("unknown"),                   # Remove "unknown" in Education
         !Died %in% c("unknown"),                        # Remove "unknown" in Died
         !Hospitalised %in% c("unknown"),                # Remove "unknown" in Hospitalised
         !method %in% c("unknown"),                      # Remove "unknown" in method
         !Urban %in% c("unknown"))                       # Remove "unknown" in Urban

# Check the size of the cleaned dataset
nrow(cleaned_data)
```

```{r}

cleaned_data <- cleaned_data %>%
  mutate(method = case_when(
    method %in% c("Poison", "Poison unspec", "Other poison") ~ "Poison",
    TRUE ~ method  # Keep other categories unchanged
  ))

# Check the updated counts for the 'method' column
table(cleaned_data$method)

```

```{r}
# Ensure 'Died' is a binary factor with levels "no" and "yes"
cleaned_data$Died <- factor(cleaned_data$Died, levels = c("no", "yes"))

# Build the logistic regression model
death_model <- glm(Died ~ Age + Sex + Education + method + Urban + Year + Month, 
                   data = cleaned_data, 
                   family = binomial)

# View model summary
summary(death_model)

# Calculate odds ratios for interpretation
exp(coef(death_model))

```

```{r}
# Create a new column 'Season' based on the month
cleaned_data <- cleaned_data %>%
  mutate(Season = case_when(
    Month %in% c(12, 1, 2) ~ "Winter",
    Month %in% c(3, 4, 5) ~ "Spring",
    Month %in% c(6, 7, 8) ~ "Summer",
    Month %in% c(9, 10, 11) ~ "Fall"
  ))

# Check the counts for each season
table(cleaned_data$Season)

```

```{r}
# Update the logistic regression model with 'Season' instead of 'Month'
death_model_season <- glm(Died ~ Age + Sex + Education + method + Urban + Year + Season, 
                          data = cleaned_data, 
                          family = binomial)

# View the model summary
summary(death_model_season)

# Calculate odds ratios for interpretation
exp(coef(death_model_season))
```

```{r}
# Convert Year into a categorical variable
cleaned_data$Year <- as.factor(cleaned_data$Year)

# Check the levels to confirm
levels(cleaned_data$Year)
```

```{r}
# Logistic regression with Year as a categorical variable
death_model_categorical <- glm(Died ~ Age + Sex + Education + method + Urban + Season + Year, 
                               data = cleaned_data, 
                               family = binomial)

# View model summary
summary(death_model_categorical)

# Calculate odds ratios
exp(coef(death_model_categorical))

```

```{r}
# Plot Age and Sex interaction
ggplot(cleaned_data, aes(x = Age, y = as.numeric(Died == "yes"), color = Sex)) +
  geom_smooth(method = "glm", method.args = list(family = "binomial")) +
  labs(
    title = "Interaction Between Age and Sex on Death Outcome",
    x = "Age",
    y = "Probability of Death"
  )


```

```{r}

# Create a bar plot showing proportions
ggplot(cleaned_data, aes(x = Education, fill = Died)) +
  geom_bar(position = "fill") +
  facet_wrap(~ Urban) +
  labs(
    title = "Proportion of Deaths by Education Level and Urban/Rural",
    x = "Education Level",
    y = "Proportion",
    fill = "Died"
  )

```

```{r}
# Add Education and Urban interaction to the model
final_model <- glm(Died ~ Age + Education + method + Season + Year + Sex, 
                         data = cleaned_data, 
                         family = binomial)

# View the model summary
summary(final_model)

```

```{r}
roc_curve <- roc(cleaned_data$Died, predict(death_model_categorical, type = "response"))
plot(roc_curve)
auc(roc_curve)


```

```{r}

final_model <- glm(Died ~ Hospitalised + method + Year + Education + Season + Sex + Age, 
                         data = cleaned_data, 
                         family = binomial)


summary(final_model)


```

```{r}
model_no_hospital <- glm(Died ~ method + Year + Education + Season + Sex + Age, 
                         data = cleaned_data, family = binomial)

# Fit model with "Hospitalised"
model_with_hospital <- glm(Died ~ Hospitalised + method + Year + Education + Season + Sex + Age, 
                           data = cleaned_data, family = binomial)


vif(model_with_hospital)

```

```{r}

# To create a combined outcome variable
cleaned_data$Outcome <- case_when(
  cleaned_data$Died == "yes" ~ "Died",
  cleaned_data$Hospitalised == "yes" ~ "Hospitalised",
  TRUE ~ "Not_Hospitalised"
)


cleaned_data$Outcome <- factor(cleaned_data$Outcome, levels = c("Died", "Hospitalised", "Not_Hospitalised"))

# Fit multinomial logistic regression
multinom_model <- multinom(Outcome ~ Age + Sex + Education + method + Urban + Year + Season, 
                           data = cleaned_data)

summary(multinom_model)
exp(coef(multinom_model))


```

```{r}
# fixed - fit three level  - this is the wrong one not to use 
cleaned_data$Outcome <- case_when(
  cleaned_data$Died == "yes" ~ "High_Fatality",                   # Dead, regardless of hospitalization
  cleaned_data$Died == "no" & cleaned_data$Hospitalised == "yes" ~ "Medium_Fatality",  # Not dead but hospitalized
  cleaned_data$Died == "no" & cleaned_data$Hospitalised == "no" ~ "Low_Fatality"      # Not dead and not hospitalized
)

cleaned_data$Outcome <- factor(cleaned_data$Outcome, 
                               levels = c("High_Fatality", "Medium_Fatality", "Low_Fatality"))


table(cleaned_data$Outcome)

```

```{r}
#only fit the two level - medium and high?
cleaned_data$Outcome <- case_when(
  cleaned_data$Died == "yes" ~ "High_Fatality",     # Dead (high-fatality)
  cleaned_data$Died == "no" & cleaned_data$Hospitalised == "yes" ~ "Medium_Fatality" # Survived and hospitalized
)


cleaned_data$Outcome <- factor(cleaned_data$Outcome, 
                               levels = c("High_Fatality", "Medium_Fatality"))

table(cleaned_data$Outcome)
```

```{r}

# urban? + death
ggplot(cleaned_data, aes(x = Urban, fill = Died)) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Deaths by Urban/Rural Location",
    x = "Location (Urban/Rural)",
    y = "Proportion",
    fill = "Died Status"
  ) +
  theme_minimal()

```

```{r}
# % Urban/Rural
proportions <- cleaned_data %>%
  group_by(Urban, Died) %>%
  summarise(Count = n()) %>%
  mutate(Proportion = Count / sum(Count)) %>%
  arrange(Urban, Died)

print(proportions)


```

```{r}
# final model? 
binary_model <- glm(Outcome ~ Age + Sex + Education + method + Year + Season, 
                    data = cleaned_data, 
                    family = binomial)

summary(binary_model)

# Convert coefficients to odds ratios
exp(coef(binary_model))

```

```{r}
# new attempt - ? 
cleaned_data$Outcome <- case_when(
  cleaned_data$Died == "yes" & cleaned_data$Hospitalised == "yes" ~ "Died-Hospital",
  cleaned_data$Died == "no" & cleaned_data$Hospitalised == "yes" ~ "Survived",
  cleaned_data$Died == "yes" & cleaned_data$Hospitalised == "no" ~ "ImmediateDeath"
)


cleaned_data$Outcome <- factor(cleaned_data$Outcome, 
                               levels = c("Died-Hospital", "Survived", "ImmediateDeath"))

table(cleaned_data$Outcome)


```

```{r}
# final fianl model ? new combined model?


#?multinomial logistic regression model

multinom_model <- multinom(Outcome ~ Age + Sex + Education + method + Urban + Year + Season, 
                           data = cleaned_data)

summary(multinom_model)

## cannot use this model this is wrong.
```

```{r}
## Need to be fixed
z_values <- summary(multinom_model)$coefficients / summary(multinom_model)$standard.errors
p_values <- 2 * (1 - pnorm(abs(z_values)))
p_values
## oops something wrong...
```

```{r}
# Custom blue palette
blue_palette <- c("#08306B", "#4292C6", "#9ECAE1")

# Base theme for all plots
base_theme <- theme_minimal(base_size = 10) + 
  theme(
    legend.position = "none",  # Suppress legends in individual plots
    plot.title = element_text(size = 10),
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 8)
  )

# Plot 1: Deaths by Gender
plot1 <- ggplot(cleaned_data, aes(x = Sex, fill = Died)) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Deaths by Gender", x = "Gender", y = "Proportion") +
  base_theme

# Plot 2: Death by Age Distribution
plot2 <- ggplot(cleaned_data, aes(x = Age, fill = Died)) +
  geom_histogram(binwidth = 5, color = "white", position = "stack") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Death by Age Distribution", x = "Age", y = "Count") +
  base_theme

# Plot 3: Deaths by Year
plot3 <- ggplot(cleaned_data, aes(x = factor(Year), fill = Died)) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Deaths by Year", x = "Year", y = "Proportion") +
  base_theme

# Plot 4: Death by Suicide Methods
plot4 <- ggplot(cleaned_data, aes(x = method, fill = Died)) +
  geom_bar() +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Death by Suicide Methods", x = "Method", y = "Count") +
  base_theme +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Combine the plots into a 2x2 grid with a single shared legend
combined_plot <- (plot1 + theme(legend.position = "bottom")) | plot2 / 
                 plot3 | plot4 + 
                 plot_layout(guides = "collect") &
                 theme(legend.position = "bottom")

# Display the combined plot
combined_plot

```
```{r}

# Custom blue palette for Outcome levels
blue_palette <- c("High_Fatality" = "#08306B", "Medium_Fatality" = "#4292C6")

# Theme adjustments for readability
custom_theme <- theme_minimal(base_size = 11) + 
  theme(
    plot.title = element_text(size = 11, hjust = 0.5),
    axis.title = element_text(size = 9),
    axis.text = element_text(size = 6),
    legend.text = element_text(size = 10),
    legend.title = element_text(size = 10)
  )

# Plot 1: Age vs Outcome
plot1 <- ggplot(cleaned_data, aes(x = Age, fill = Outcome)) +
  geom_histogram(bins = 20, position = "stack", color = "white") +
  facet_wrap(~ Outcome, scales = "free_y") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Age Distribution by Outcome", x = "Age", y = "Count", fill = "Outcome") +
  custom_theme

# Plot 2: Gender vs Outcome
plot2 <- ggplot(cleaned_data, aes(x = Sex, fill = Outcome)) +
  geom_bar(position = "fill", color = "white") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Gender Proportion by Outcome", x = "Gender", y = "Proportion", fill = "Outcome") +
  custom_theme

# Plot 3: Education Level vs Outcome
plot3 <- ggplot(cleaned_data, aes(x = Education, fill = Outcome)) +
  geom_bar(position = "fill", color = "white") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Education Level by Outcome", x = "Education Level", y = "Proportion", fill = "Outcome") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  custom_theme

# Plot 4: Suicide Methods vs Outcome
plot4 <- ggplot(cleaned_data, aes(x = method, fill = Outcome)) +
  geom_bar(position = "dodge", color = "white") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Suicide Methods by Outcome", x = "Method", y = "Count", fill = "Outcome") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  custom_theme

# Plot 5: Year vs Outcome
plot5 <- ggplot(cleaned_data, aes(x = as.factor(Year), fill = Outcome)) +
  geom_bar(position = "fill", color = "white") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Outcome Results by Year", x = "Year", y = "Proportion", fill = "Outcome") +
  custom_theme

# Plot 6: Season vs Outcome
plot6 <- ggplot(cleaned_data, aes(x = Season, fill = Outcome)) +
  geom_bar(position = "fill", color = "white") +
  scale_fill_manual(values = blue_palette) +
  labs(title = "Outcome Results by Season", x = "Season", y = "Proportion", fill = "Outcome") +
  custom_theme

# Combine all plots into a 2x3 grid layout with shared legend
combined_plot <- (plot1 | plot2 | plot3) / (plot4 | plot5 | plot6) +
  plot_layout(guides = "collect") &
  theme(legend.position = "bottom")

# Display the combined plot
combined_plot

```

```{r}

linear_model <- lm(as.numeric(Outcome) ~ Age + Sex + Education + method + Year + Season, data = cleaned_data)

vif_values <- vif(linear_model)
print(vif_values)


```


```{r}

## final final model!

 
final_model1 <- glm(Outcome ~ Age + Sex + Education + method + Year + Season, 
                    data = cleaned_data, 
                    family = binomial)

summary(final_model1)


exp(coef(final_model1))


```




```{r}

# Coefficient Table Data
results_table <- data.frame(
  Predictor = c("Intercept", "Age", "Sex (male)", "Education (Primary)", 
                "Education (Secondary)", "Education (Tertiary)",
                "Method (Drowning)", "Method (Hanging)", "Method (Jumping)",
                "Method (Pesticide)", "Method (Poison)", "Method (Unspecified)",
                "Year (2010)", "Year (2011)", "Season (Spring)", 
                "Season (Summer)", "Season (Winter)"),
  Estimate = c(1.123417, -0.017616, -0.318367, 0.822793, 2.481094, 
               0.865654, -17.578842, -4.133257, -3.737283, 
               -0.984085, 1.389876, 1.684696, -0.356449, -0.628994, 
               -0.421115, 0.058410, -0.402991),
  Std_Error = c(0.607402, 0.003917, 0.116802, 0.180521, 0.191751, 
                1.084484, 416.613360, 0.624076, 1.228425, 
                0.540250, 0.609575, 0.839992, 0.141794, 0.146920, 
                0.164219, 0.156023, 0.174818),
  Z_value = c(1.850, -4.498, -2.726, 4.558, 12.939, -0.798, 
              -0.042, -6.623, -3.042, -1.822, 2.280, 2.006, 
              -2.514, -4.281, -2.564, 0.374, -2.305),
  P_value = c(0.06438, 6.87e-06, 0.00642, 5.17e-06, 2e-16, 
              0.42474, 0.96634, 3.52e-11, 0.00235, 
              0.06853, 0.02260, 0.04490, 0.01194, 1.86e-05, 
              0.01034, 0.70813, 0.02116)
)

# Professional Table with kableExtra
results_table %>%
  kable("html", caption = "Binary Logistic Regression Results", align = "lcccc") %>%
  kable_styling(full_width = F, font_size = 12, position = "center", bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  column_spec(1, bold = TRUE, width = "3cm") %>%
  column_spec(2:5, width = "2cm") %>%
  row_spec(0, bold = TRUE, background = "#D3D3D3") %>%
  scroll_box(height = "400px")

```


```{r}
# EDA - educational and outcome ?
cleaned_data <- data.frame(
  Outcome = c(rep("High_Fatality", 100), rep("Medium_Fatality", 50)),
  Education = rep(c("Primary", "Secondary", "Illiterate", "Tertiary", "Primary"), 30)
)

# Create the plot
ggplot(cleaned_data, aes(x = Education, fill = Outcome)) +
  geom_bar(position = "dodge") +
  scale_fill_brewer(palette = "Blues", name = "Outcome") +
  labs(
    title = "Distribution of Fatality Outcome by Education",
    x = "Education Level",
    y = "Count"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )

```


```{r}

# new eda proportional ? 
cleaned_data <- data.frame(
  Outcome = c(rep("High_Fatality", 100), rep("Medium_Fatality", 50)),
  Education = rep(c("Primary", "Secondary", "Illiterate", "Tertiary", "Primary"), 30)
)


proportion_data <- cleaned_data %>%
  group_by(Education, Outcome) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Education) %>%
  mutate(Proportion = Count / sum(Count))


ggplot(proportion_data, aes(x = Education, y = Proportion, fill = Outcome)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_fill_brewer(palette = "Blues", name = "Outcome") +
  labs(
    title = "Proportional Distribution of Fatality Outcome by Education",
    x = "Education Level",
    y = "Proportion"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )

```

```{r}
# Example dataset
cleaned_data <- data.frame(
  Hospitalised = rep(c("Yes", "No"), 150),
  Education = rep(c("Primary", "Secondary", "Illiterate", "Tertiary"), 75),
  Died = rep(c("Yes", "No"), 150)
)

# Calculate proportions
proportion_data <- cleaned_data %>%
  group_by(Education, Hospitalised, Died) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Education, Hospitalised) %>%
  mutate(Proportion = Count / sum(Count))

# Create the plot
ggplot(proportion_data, aes(x = Education, y = Proportion, fill = Died)) +
  geom_bar(stat = "identity", position = "fill") +
  facet_wrap(~ Hospitalised, scales = "free_y") +
  scale_fill_brewer(palette = "Blues", name = "Died") +
  labs(
    title = "Proportional Distribution of Death by Education and Hospitalisation",
    x = "Education Level",
    y = "Proportion"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )


```

```{r}
# Example dataset
set.seed(123)
cleaned_data <- data.frame(
  Hospitalised = sample(c("Yes", "No"), 200, replace = TRUE),
  Education = sample(c("Primary", "Secondary", "Illiterate", "Tertiary"), 200, replace = TRUE)
)

# Calculate proportions
proportion_data <- cleaned_data %>%
  group_by(Education, Hospitalised) %>%
  summarise(Count = n(), .groups = "drop") %>%
  group_by(Education) %>%
  mutate(Proportion = Count / sum(Count))

# Create a proportional bar plot
ggplot(proportion_data, aes(x = Education, y = Proportion, fill = Hospitalised)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_fill_brewer(palette = "Blues", name = "Hospitalised") +
  labs(
    title = "Proportional Distribution of Hospitalisation by Education Level",
    x = "Education Level",
    y = "Proportion"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )
```
